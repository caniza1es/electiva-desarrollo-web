<%- include('partials/header', { pageTitle: 'Jergar.io' }) %>

<main>
    <h2>Bienvenido a Jergar.io</h2>
    <p><em>Para que no te hablen raro</em></p> 
    <p>Jergar.io es el diccionario de jerga donde puedes buscar, descubrir y compartir el verdadero lenguaje callejero.</p>
    
    <form action="/" method="GET">
        <div>
            <label for="searchText">Buscar Jerga:</label>
            <input type="text" id="searchText" name="searchText" placeholder="Ej. chevere" value="<%= searchText || '' %>">
        </div>

        <div>
            <label for="author">Autor:</label>
            <input type="text" id="author" name="author" placeholder="Ej. user123" value="<%= author || '' %>">
        </div>

        <div>
            <label for="region">Regi√≥n:</label>
            <select id="region" name="region">
                <option value="">Todas</option>
                <% const regiones = ['Espa√±a', 'M√©xico', 'Argentina', 'Colombia', 'Chile', 'Per√∫', 'Venezuela', 'Ecuador', 'Guatemala', 'Cuba', 'Bolivia', 'Honduras', 'Paraguay', 'El Salvador', 'Nicaragua', 'Costa Rica', 'Puerto Rico', 'Panam√°', 'Uruguay', 'Rep√∫blica Dominicana']; %>
                <% regiones.forEach(regionOption => { %>
                    <option value="<%= regionOption %>" <%= region === regionOption ? 'selected' : '' %>><%= regionOption %></option>
                <% }) %>
            </select>
        </div>

        <div>
            <button type="submit">Buscar</button>
        </div>
    </form>

    <section>
        <h3>Resultados de b√∫squeda</h3>
        <% if (slangs.length > 0) { %>
            <ul>
                <% slangs.forEach(slang => { %>
                    <li>
                        <h4><%= slang.slang %></h4>
                        <p><strong>Definici√≥n:</strong> <%= slang.definition %></p>
                        <p><strong>Ejemplo:</strong> <%= slang.example %></p>
                        <p><strong>Autor:</strong> 
                            <a href="?searchText=<%= searchText %>&region=<%= region %>&author=<%= slang.byUser %>"><%= slang.byUser %></a> 
                            | <strong>Regi√≥n:</strong> <%= slang.region %>
                        </p>
                        <p><strong>Fecha:</strong> <%= slang.datetime.toLocaleDateString() %></p>
                        <form action="/slangs/<%= slang._id %>/upvote" method="POST" style="display:inline;">
                            <button type="submit">üëç <%= slang.upvotes %></button>
                        </form>
                        <form action="/slangs/<%= slang._id %>/downvote" method="POST" style="display:inline;">
                            <button type="submit">üëé <%= slang.downvotes %></button>
                        </form>

                        <% if (isAdmin) { %>
                            <form action="/slangs/<%= slang._id %>/delete" method="POST" style="display:inline;" class="delete-slang-form">
                                <button type="button" class="delete-slang-button">üóëÔ∏è Eliminar</button>
                            </form>
                        <% } %>
                    </li>
                <% }) %>
            </ul>
    
            <div class="pagination">
                <% if (currentPage > 1) { %>
                    <a href="?searchText=<%= searchText %>&author=<%= author %>&region=<%= region %>&page=<%= currentPage - 1 %>">Anterior</a>
                <% } %>
    
                <% for (let i = 1; i <= totalPages; i++) { %>
                    <a href="?searchText=<%= searchText %>&author=<%= author %>&region=<%= region %>&page=<%= i %>" 
                       class="<%= i === currentPage ? 'active' : '' %>">
                       <%= i %>
                    </a>
                <% } %>
    
                <% if (currentPage < totalPages) { %>
                    <a href="?searchText=<%= searchText %>&author=<%= author %>&region=<%= region %>&page=<%= currentPage + 1 %>">Siguiente</a>
                <% } %>
            </div>
        <% } else { %>
            <p>No se encontraron resultados para los criterios de b√∫squeda.</p>
        <% } %>
    </section>
    
<%- include('./partials/footer') %>    

</main>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.delete-slang-button');
        
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const form = this.closest('.delete-slang-form');
                
                Swal.fire({
                    title: '¬øEst√°s seguro?',
                    text: "Esta acci√≥n eliminar√° la jerga de forma permanente.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'S√≠, eliminar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            });
        });
    });
</script>
